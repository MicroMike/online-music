<!doctype html>
<html>

<head>
  <title>Socket.IO chat</title>
  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript">
    var socket = io();

    const reboot = () => {
      console.log('reset')
      socket.emit('a')
    }

    const clearScreen = () => {
      document.querySelector('.screenshot').innerHTML = ''
      socket.emit('clearScreen')
    }

    const check = () => {
      socket.emit('check')
    }

    const endCheck = () => {
      socket.emit('endCheck')
    }

    socket.on('activate', () => {
      socket.emit('web')
    })

    socket.on('logError', log => {
      socket.emit('web')
    })

    const streamOn = streamId => {
      socket.emit('streamOn', streamId)
      const btn = document.querySelector('#btn' + streamId)
      btn.innerText = 'streamOff'
      btn.onclick = 'streamOff(\'' + streamId + '\')'
    }

    const streamOff = streamId => {
      socket.emit('streamOff', streamId)
      const btn = document.querySelector('#btn' + streamId)
      btn.innerText = 'streamOn'
      btn.onclick = 'streamOn(\'' + streamId + '\')'
    }

    socket.on('delList', (delList) => {
      document.querySelector('#del').innerHTML = delList
    })

    socket.on('stream', ({ streamOff, streamId, log, img }) => {
      const isDom = document.querySelector('#class' + streamId)
      const streamBtn = streamOff ? 'streamOn' : 'streamOff'
      if (!isDom) {
        document.querySelector('.screenshot').insertAdjacentHTML('beforeEnd', '<div><h2>' + log + ' :</h2><button id="btn' + streamId + '" onClick="' + streamBtn + '(\'' + streamId + '\')">' + streamBtn + '</button><img id="class' + streamId + '" src="data:image/png;base64,' + img + '"/></div>')
      }
      else {
        isDom.src = 'data:image/png;base64,' + img
      }
    })
  </script>
</head>

<body>
  <button onClick="reboot()">RESET</button>
  <button onClick="clearScreen()">CLEAR SCREENSHOT</button>
  <button onClick="check()">CHECK</button>
  <button onClick="endCheck()">END CHECK</button>
  <div id="del"></div>
  <div class="screenshot"></div>
  <div class="stream"></div>
</body>

</html>